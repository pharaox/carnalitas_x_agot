# carnx_add_courtier_effect allows compatibility mods to prevent conversion mods (e.g. AGOT) from redirecting courtiers.
carnx_add_courtier_effect = {
	# Remove nightswatch / silent sister trait and set culture to owner's culture
	# to prevent AGOT from redirecting the courtier to a different court
	$SLAVE$ = {
		if = {
			limit = { has_trait = nightswatch }
			carnx_debug_log_effect = { MSG = carnx_debug_msg_adding_courtier_nightswatch }
			save_temporary_scope_value_as = { name = saved_trait value = flag:nightswatch }
			remove_trait = nightswatch
		}
		else_if = {
			limit = { has_trait = silent_sister }
			carnx_debug_log_effect = { MSG = carnx_debug_msg_adding_courtier_silent_sister }
			save_temporary_scope_value_as =  { name = saved_trait value = flag:silent_sister }
			remove_trait = silent_sister
		}
		if = {
			limit = {
				trigger_if = {
					limit = {
						culture = { agot_is_wildling_culture = yes }
					}
					prev = {
						culture = { agot_is_wildling_culture = no }
					}
				}
				trigger_else = {
					prev = {
						culture = { agot_is_wildling_culture = yes }
					}
				}
			}
			carnx_debug_log_effect = { MSG = carnx_debug_msg_adding_courtier_wildling }
			culture = { save_temporary_scope_as = saved_culture }
			set_culture = prev.culture
		}
	}

	add_courtier = $SLAVE$

	# Restore original trait and culture
	$SLAVE$ = {
		if = {
			limit = { scope:saved_trait ?= flag:nightswatch }
			add_trait = nightswatch
		}
		else_if = {
			limit = { scope:saved_trait ?= flag:silent_sister }
			add_trait = silent_sister
		}
		if = {
			limit = { exists = scope:saved_culture }
			set_culture = scope:saved_culture
		}
	}
}
